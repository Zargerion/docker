# üê≥ Docker-in-Docker (DinD) –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Docker-in-Docker?

**Docker-in-Docker (DinD)** - —ç—Ç–æ –∑–∞–ø—É—Å–∫ Docker daemon –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏–∑–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Host Docker
‚îú‚îÄ docker-dind –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ  ‚îú‚îÄ Docker daemon (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
‚îÇ  ‚îú‚îÄ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–Ω—É—Ç—Ä–∏ DinD
‚îÇ  ‚îî‚îÄ Docker API (–ø–æ—Ä—Ç 2376)
‚îú‚îÄ docker-client –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ  ‚îî‚îÄ Docker CLI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DinD
‚îî‚îÄ portainer –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   ‚îî‚îÄ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

## üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å DinD
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs docker-dind
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–ª–∏–µ–Ω—Ç—É
```bash
docker exec -it docker-client sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker –≤–Ω—É—Ç—Ä–∏ DinD
```bash
# –í–Ω—É—Ç—Ä–∏ docker-client –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker version
docker info
```

### 3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω—É—Ç—Ä–∏ DinD
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å nginx –≤–Ω—É—Ç—Ä–∏ DinD
docker run -d --name test-nginx -p 8080:80 nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stop test-nginx
```

### 4. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Portainer
- –û—Ç–∫—Ä—ã—Ç—å: http://localhost:9000
- –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Docker environment

## üéØ –ó–∞—á–µ–º –Ω—É–∂–Ω–æ DinD?

### 1. CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
```yaml
# GitLab CI
build:
  image: docker:dind
  services:
    - docker:dind
  script:
    - docker build -t myapp .
    - docker run myapp
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Docker
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile
- –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

### 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Docker
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û—Ç–ª–∞–¥–∫–∞ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### 4. –û–±—É—á–µ–Ω–∏–µ
- –ò–∑—É—á–µ–Ω–∏–µ Docker –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ö–æ—Å—Ç
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- `privileged: true` - –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞
- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç —Ö–æ—Å—Ç–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –î–≤–æ–π–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
- –ë–æ–ª—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º –æ–±—ã—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- Docker Socket Mounting (DooD)
- Kubernetes DinD
- Podman-in-Podman

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –û—á–∏—Å—Ç–∫–∞
docker-compose down -v --rmi all

# –õ–æ–≥–∏
docker-compose logs -f docker-dind
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats docker-dind docker-client portainer

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
docker system df

# –ü—Ä–æ—Ü–µ—Å—Å—ã –≤ DinD
docker exec docker-dind ps aux
```
